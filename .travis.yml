# Linux builds are only to make sure the project can be built w/ MinGW-w64 &
# GCC.

language: cpp
os: linux
# MinGW-w64 7.0 or higher is required, hence the latest distribution.
dist: focal

env:
  global:
    boost_version: 1.65.0
  jobs:
    - configuration=Debug   platform=x86
    - configuration=Release platform=x86
    - configuration=Debug   platform=x64
    - configuration=Release platform=x64

before_script:
  - cd cmake
  - >-
    python3 -m project.ci.travis.boost
    --mingw
    --
    --with-filesystem
    --with-program_options
    --with-test

script: >-
    python3 -m project.ci.travis.cmake
    --install "$HOME/install"
    --mingw

jobs:
  fast_finish: true

  include:
    - name: Run clang-format
      if: branch = master
      addons:
        apt:
          update: true
          packages:
            - clang-format-9
          sources:
            - sourceline: 'deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic-9 main'
              key_url: 'https://apt.llvm.org/llvm-snapshot.gpg.key'
      script: ./cmake/tools/clang-format.py --clang-format clang-format-9
